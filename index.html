<html lang="en">
<head>
	<title>Wilbertz Socket.IO Chat App</title>
	<style>		
      #data { border: 1px solid #5fd051; padding: 10px; width: 76%; margin-right: 1%; }form button { width: 21%; background: #5fd051;color: #fff; border: none; padding: 8px; border-radius: 35px; } button:focus { outline: none; }
	  body,hr{background:#e9e9e9;margin:0}fieldset,hr,img,input{border:0}body,fieldset,h4,h5,hr,input,p{margin:0}body{color:#9a9a9a;font:100%/1.5em "Droid Sans",sans-serif}a{text-decoration:none}fieldset{padding:0}h4,h5{line-height:1.5em}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:1px;min-height:1px}img{display:block;height:auto;max-width:100%}input{color:inherit;font-family:inherit;font-size:100%;line-height:normal}#live-chat,#live-chat h4{font-size:12px}.clearfix:after,.clearfix:before{content:"";display:table}.clearfix:after{clear:both}#live-chat{bottom:0;right:24px;position:fixed;width:300px}#live-chat header{background:#293239;border-radius:5px 5px 0 0;color:#fff;cursor:pointer;padding:16px 24px}#live-chat h4:before{background:#1a8a34;border-radius:50%;content:"";display:inline-block;height:8px;margin:0 8px 0 0;width:8px}#live-chat h5{font-size:10px}#live-chat form{padding:24px}#live-chat input[type=text]{border:1px solid #ccc;border-radius:3px;padding:8px;outline:0;width:234px}.chat-message-counter{background:#e62727;border:1px solid #fff;border-radius:50%;display:none;font-size:12px;font-weight:700;height:28px;left:0;line-height:28px;margin:-15px 0 0 -15px;position:absolute;text-align:center;top:0;width:28px}.chat-close{background:#1b2126;border-radius:50%;color:#fff;display:block;float:right;font-size:10px;height:16px;line-height:16px;margin:2px 0 0;text-align:center;width:16px}.chat{background:#fff}.chat-history{height:252px;padding:8px 24px;overflow-y:scroll}.chat-message{margin:16px 0}.chat-message img{border-radius:50%;float:left}.chat-message-content{margin-left:0px}.chat-time{float:right;font-size:10px}.chat-feedback{font-style:italic;margin:0 0 0 20px}	  
	</style>	
</head>
<body>

	<div id="live-chat">		
		<header class="clearfix">			
			<a href="#" class="chat-close">x</a>
			<h4>We are Online </h4>
			<span class="chat-message-counter">3</span>
		</header>
		<div class="chat">			
			<div id="chat" class="chat-history"></div>			
			<p class="chat-feedback">Your partner is typing…</p>
			<form action="#">
				<fieldset>
					<input id="data" placeholder="Type your message…" autofocus autocomplete="off" />
					<button>Send</button>
				</fieldset>
			</form>
		</div> 
	</div> 

	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	
	<script type="text/javascript">
	$(() => {
		const socket = io();		
		let my_username = '';
		
		
		const getthetime = () => {
			let d = new Date();
			let h = d.getHours();
			let m = d.getMinutes();
			
			return h+' : '+m ;
		}
		
		// when the user sends a private msg to a user id, first find the username
		const sendmsg = id => socket.emit('check_user', my_username, id);
		
		// on connection to server, ask for user's name with an anonymous callback
		socket.on('connect', () => socket.emit('adduser', prompt("What's your name?")));
		
		// listener, whenever the server emits 'msg_user_handle', this updates the chat body
		socket.on('msg_user_handle', (username, data) => $('#chat').append('<div class="chat-message clearfix"><div class="chat-message-content clearfix"><span class="chat-time">'+ getthetime() +'</span><h5>' +username+ '</h5><p>' + data + '</p></div></div><hr>'));
		
		// listener, whenever the server emits 'msg_user_found'
		socket.on('msg_user_found', username => socket.emit('msg_user', username, my_username, prompt("Type your message:")));
		
		// listener, whenever the server emits 'updatechat', this updates the chat body
		socket.on('updatechat',  (username, data) => $('#chat').append('<div class="chat-message clearfix"><div class="chat-message-content clearfix"><span class="chat-time">'+ getthetime() +'</span><h5>' +username+ '</h5><p>' + data + '</p></div></div><hr>'));
		
		// listener, whenever the server emits 'store_username', this updates the username
		socket.on('store_username', username => my_username = username);

		// when the client clicks SEND
		$('form').submit(() => {
				let message = $('#data').val();
				if(message == '' || jQuery.trim(message).length == 0 || message == 'undefined'){
				return false;
				} else {
				$('#data').val('');
				// tell server to execute 'sendchat' and send along one parameter
				socket.emit('sendchat', message);
				return false;
				}
		});
		
		$('#live-chat header').on('click', function() {
			$('.chat').slideToggle(300, 'swing');
			$('.chat-message-counter').fadeToggle(300, 'swing');
		});
		
	});
	</script>
	
</body>
</html>